
<!DOCTYPE html>
<html lang='en' class=''>

<head>

  <meta charset='UTF-8'>
  <title>Shortly</title>

  <link rel="stylesheet" href="/static/css/indexStyle.css">
  <meta name="robots" content="noindex">

  <link rel="shortcut icon" type="image/x-icon" href="assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico">
  <link rel="mask-icon" href="/static/favicon/logo-pin-b4b4269c16397ad2f0f7a01bcdf513a1994f4c94b8af2f191c09eb0d601762b1.svg" color="#111">

  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700&amp;display=swap">
  <!-- <link rel="stylesheet" href="/static/css/libs/meyer-reset/reset.min.css"> -->

  <script> const submit_url= "/shortlink/create" </script>

  <style>
    .fill:hover,
    .fill:focus {
      box-shadow: inset 0 0 0 2em var(--hover);
    }

    .submit-button {
      display: block; 
      height: 50px; 
      width: 50px; 
      border-radius: 50%; 
      border: 1px; 
      text-align: center; 
      background-color: #1E90FF;  
      transition: background .1s;

      &:hover,
      &:focus {
          color: white;
      }
      
      &:active {
          top: .08em;
      }
      
    }

    .submit-div {
      margin-left: 11px; 
      text-align: center;
    }

    #copy-svg {
      display: none;
    }

    #submit-svg {
      display: true;
    }

    .svg-icon {
      position: relative;
      top: .125em;

      flex-shrink: 0;

      fill: currentColor;

      transition: fill .3s;
    }

  </style>
</head>

<body>
  <div class="url-input">
    <div class="icon">
        <svg viewBox="0 0 18 18">
            <path d="M10.05 7.95001C11.55 9.45001 11.55 11.775 10.05 13.275L7.95 15.375C6.45 16.875 4.125 16.875 2.625 15.375C1.125 13.875 1.125 11.55 2.625 10.05L4.5 8.25001" />
            <path d="M7.9502 10.05C6.4502 8.55 6.4502 6.225 7.9502 4.725L10.0502 2.625C11.5502 1.125 13.8752 1.125 15.3752 2.625C16.8752 4.125 16.8752 6.45 15.3752 7.95L13.5002 9.75" />
        </svg>
        <div class="favicon"></div>
    </div>
    <div class="text">
        <input type="text" placeholder="Your URL" />
    </div>
    <button class="clear">
        <svg viewBox="0 0 24 24">
            <path class="line" d="M2 2L22 22" />
            <path class="long" d="M9 15L20 4" />
            <path class="arrow" d="M13 11V7" />
            <path class="arrow" d="M17 11H13" />
        </svg>
    </button>
</div>

<div class="submit-div">
  <button class="submit-button" id="submit-button" type="button">
    <div id="submit-svg">
      <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" height="2em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M438.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.8 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l306.7 0L233.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z"/></svg>
    </div>
    <div id="copy-svg" >
      <svg class="svg-icon" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M24.7397 9.91727V19.9465C24.7397 21.0543 23.8416 21.9524 22.7338 21.9524C22.1799 21.9524 21.7309 21.5033 21.7309 20.9494V14.27C21.7315 13.9643 21.6085 13.6713 21.3899 13.4576L17.8997 10.0075C17.2774 9.37513 16.4301 9.01459 15.5429 9.00461H11.7017C11.1478 9.00461 10.6987 8.55559 10.6987 8.00169V6.87841C10.6987 6.11327 11.0034 5.37962 11.5454 4.83953C12.0873 4.29943 12.822 3.99735 13.5872 4.00002H18.9127C19.6658 4.00761 20.3859 4.31006 20.9186 4.84247L23.9273 7.85125C24.4625 8.40421 24.7549 9.14788 24.7397 9.91727ZM19.8855 13.929L16.8768 10.9202C16.3453 10.386 15.6244 10.0832 14.8709 10.0777H9.54539C7.95407 10.0833 6.66698 11.3748 6.66699 12.9662V25.1116C6.66699 26.7068 7.96018 28 9.55541 28H17.8697C19.4531 27.9835 20.7281 26.6951 20.728 25.1116V15.9348C20.7358 15.1776 20.4479 14.4472 19.9257 13.8989L19.8855 13.929Z" ></path>
      </svg>
    </div>
  </button>
</div>

<script src="/static/js/libs/gsap/gsap.min.js"></script>
<script id="rendered-js" >
    const { to, set, timeline } = gsap;
    
    const submitButton = document.getElementById("submit-button");
    const submitDiv = document.getElementById("submit-svg");
    const copyDiv = document.getElementById("copy-svg")

    var shortedUrl = "smol";
    submitButton.addEventListener("click", shortenurl);

    function getInputText(){
      const elem = document.querySelector('.url-input');
      const url = elem.querySelector('input').value;
      return url;
    }

    function validURL(string) {
      let url;
      if(!string.startsWith("http")){
        string = "http://" + string
        console.log(string);
      }
      try {
        url = new URL(string);
      } catch (_) {
      return false;  
      }

      return url.protocol === "http:" || url.protocol === "https:";
    }

    function isShortUrl(str){
      const text = getInputText();
      
      const host = origin.split("//")[1];
      if(text.startsWith(host)){
        return true;
      }
      return false;
    }
    
    function delay(fn, ms) {
      let timer = 0;
      return function (...args) {
        clearTimeout(timer);
        timer = setTimeout(fn.bind(this, ...args), ms || 0);
      };
    }

    function setCopyMode(){
      submitDiv.style.display = "none";
      copyDiv.style.display = "block";
      submitButton.removeEventListener("click", shortenurl)
      submitButton.addEventListener("click", copylink);

      const elem = document.querySelector('.url-input');
      const text = elem.querySelector('input');

      text.addEventListener('input',newUrlTrack);

    }

    function setSubmitMode(){
      submitDiv.style.display = "block";
      copyDiv.style.display = "none";
      submitButton.removeEventListener("click", copylink)
      submitButton.addEventListener("click", shortenurl);
    }

    async function newUrlTrack(event){
      const text = getInputText();
      if(!text.startsWith(origin)){
        console.log("habibi");
        
        const elem = document.querySelector('.url-input');
        const text = elem.querySelector('input');
        text.removeEventListener('input', newUrlTrack);
        setSubmitMode();
      }
    }

    function copylink(event) {
      const elem = document.querySelector('.url-input');
      const text = elem.querySelector('input');
      
      text.select();
      document.execCommand("copy");

    }
    
    async function shortenurl(event){
      event.preventDefault();
      
      const formData = new FormData();
      
      const url = getInputText();

      if(!validURL(url) || isShortUrl(url)){
        return;
      }

      formData.append("url", url);
      formData.append("password_protected", false);
      formData.append("password", null);

      const access_token = localStorage.getItem('access_token');

      var headers = {};
      if(access_token){
          headers['Authorization'] = "Bearer " + access_token; 
      }

      await fetch(submit_url,  {
        headers : headers,
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data =>{
        const { success } = data;
        if(success){
          console.log(data);
          const baseUrl = origin + "/";
          const { code } = data;
          const shorturl = baseUrl + code + "/";
          
          shortedUrl = shorturl;

          performClearAnimation();

          setCopyMode();

        }
        else{
          const { errors } = data;
          
        }
      })
      .catch(error => { console.error(error) })
    }

    
    function initialSettings() {
      document.querySelectorAll('.url-input').forEach(elem => {
        let icon = elem.querySelector('.icon'),
        favicon = icon.querySelector('.favicon'),
        clear = elem.querySelector('.clear'),
        input = elem.querySelector('input'),
        { classList } = elem,
        svgLine = clear.querySelector('.line'),
        svgLineProxy = new Proxy({
          x: null },
        {
          set(target, key, value) {
            target[key] = value;
            if (target.x !== null) {
              svgLine.setAttribute('d', getPath(target.x, .1925));
            }
            return true;
          },
          get(target, key) {
            return target[key];
          } });
      
      
        svgLineProxy.x = 0;
      
        input.addEventListener('input', delay(e => {
          let bool = input.value.length,
          valid = validURL(input.value);
          to(elem, {
            '--clear-scale': bool ? 1 : 0,
            duration: bool ? .5 : .15,
            ease: bool ? 'elastic.out(1, .7)' : 'none' });
      
          to(elem, {
            '--clear-opacity': bool ? 1 : 0,
            duration: .15 });
      
          to(elem, {
            '--icon-offset': valid ? '24px' : '0px',
            duration: .15,
            delay: valid ? 0 : .2 });
      
          if (valid) {
            if (favicon.querySelector('img')) {
              favicon.querySelector('img').src = 'https://f1.allesedv.com/64/' + input.value;
              return;
            }
            let img = new Image();
            img.onload = () => {
              favicon.appendChild(img);
              to(elem, {
                '--favicon-scale': 1,
                duration: .5,
                delay: .2,
                ease: 'elastic.out(1, .7)' });
      
            };
            img.src = 'https://f1.allesedv.com/64/' + input.value;
          } else {
            if (favicon.querySelector('img')) {
              to(elem, {
                '--favicon-scale': 0,
                duration: .15,
                onComplete() {
                  favicon.querySelector('img').remove();
                } });
      
            }
          }
        }, 250));
      
        clear.addEventListener('click', e => {
          classList.add('clearing');
          set(elem, {
            '--clear-swipe-left': (input.offsetWidth - 44) * -1 + 'px' });
      
          to(elem, {
            keyframes: [{
              '--clear-rotate': '45deg',
              duration: .25 },
            {
              '--clear-arrow-x': '2px',
              '--clear-arrow-y': '-2px',
              duration: .15 },
            {
              '--clear-arrow-x': '-3px',
              '--clear-arrow-y': '3px',
              '--clear-swipe': '-3px',
              duration: .15,
              onStart() {
                to(svgLineProxy, {
                  x: 3,
                  duration: .1,
                  delay: .05 });
      
              } },
            {
              '--clear-swipe-x': 1,
              '--clear-x': (input.offsetWidth - 32) * -1 + 'px',
              duration: .45,
              onComplete() {
                input.value = '';
                input.focus();
                if (favicon.querySelector('img')) {
                  to(elem, {
                    '--favicon-scale': 0,
                    duration: .15,
                    onComplete() {
                      favicon.querySelector('img').remove();
                    } });
      
                  to(elem, {
                    '--icon-offset': '0px',
                    '--icon-offset-line': '0px',
                    duration: .15,
                    delay: .2 });
      
                }
                to(elem, {
                  '--clear-arrow-offset': '4px',
                  '--clear-arrow-offset-second': '4px',
                  '--clear-line-array': '8.5px',
                  '--clear-line-offset': '27px',
                  '--clear-long-offset': '24px',
                  '--clear-rotate': '0deg',
                  '--clear-arrow-o': 1,
                  duration: 0,
                  delay: .7,
                  onStart() {
                    classList.remove('clearing');
                  } });
      
                to(elem, {
                  '--clear-opacity': 0,
                  duration: .2,
                  delay: .55 });
      
                to(elem, {
                  '--clear-arrow-o': 0,
                  '--clear-arrow-x': '0px',
                  '--clear-arrow-y': '0px',
                  '--clear-swipe': '0px',
                  duration: .15 });
      
                to(svgLineProxy, {
                  x: 0,
                  duration: .45,
                  ease: 'elastic.out(1, .75)' });
      
              } },
            {
              '--clear-swipe-x': 0,
              '--clear-x': '0px',
              duration: .4,
              delay: .35 }] });
      
      
          to(elem, {
            '--clear-arrow-offset': '0px',
            '--clear-arrow-offset-second': '8px',
            '--clear-line-array': '28.5px',
            '--clear-line-offset': '57px',
            '--clear-long-offset': '17px',
            duration: .2 });
      
        });
      });
    }

    initialSettings();
    
    function getPoint(point, i, a, smoothing) {
      let cp = (current, previous, next, reverse) => {
        let p = previous || current,
        n = next || current,
        o = {
          length: Math.sqrt(Math.pow(n[0] - p[0], 2) + Math.pow(n[1] - p[1], 2)),
          angle: Math.atan2(n[1] - p[1], n[0] - p[0]) },
    
        angle = o.angle + (reverse ? Math.PI : 0),
        length = o.length * smoothing;
        return [current[0] + Math.cos(angle) * length, current[1] + Math.sin(angle) * length];
      },
      cps = cp(a[i - 1], a[i - 2], point, false),
      cpe = cp(point, a[i - 1], a[i + 1], true);
      return `C ${cps[0]},${cps[1]} ${cpe[0]},${cpe[1]} ${point[0]},${point[1]}`;
    }
    
    function getPath(x, smoothing) {
      return [
      [2, 2],
      [12 - x, 12 + x],
      [22, 22]].
      reduce((acc, point, i, a) => i === 0 ? `M ${point[0]},${point[1]}` : `${acc} ${getPoint(point, i, a, smoothing)}`, '');
    }
    //# sourceURL=pen.js
    
    function performClearAnimation() {
      const elem = document.querySelector('.url-input');
      const clear = elem.querySelector('.clear');
      const input = elem.querySelector('input');
      const classList = elem.classList;
      const svgLine = clear.querySelector('.line');

      let icon = elem.querySelector('.icon');
      favicon = icon.querySelector('.favicon');


      svgLineProxy = new Proxy({
        x: null },
      {
        set(target, key, value) {
          target[key] = value;
          if (target.x !== null) {
            svgLine.setAttribute('d', getPath(target.x, .1925));
          }
          return true;
        },
        get(target, key) {
          return target[key];
        } });
    
    
      svgLineProxy.x = 0;
      
      classList.add('clearing');
        set(elem, {
          '--clear-swipe-left': (input.offsetWidth - 44) * -1 + 'px' });
    
        to(elem, {
          keyframes: [{
            '--clear-rotate': '45deg',
            duration: .25 },
          {
            '--clear-arrow-x': '2px',
            '--clear-arrow-y': '-2px',
            duration: .15 },
          {
            '--clear-arrow-x': '-3px',
            '--clear-arrow-y': '3px',
            '--clear-swipe': '-3px',
            duration: .15,
            onStart() {
              to(svgLineProxy, {
                x: 3,
                duration: .1,
                delay: .05 });
    
            } },
          {
            '--clear-swipe-x': 1,
            '--clear-x': (input.offsetWidth - 32) * -1 + 'px',
            duration: .45,
            onComplete() {
              input.value = shortedUrl;
              input.focus();
              if (favicon.querySelector('img')) {
                to(elem, {
                  '--favicon-scale': 0,
                  duration: .15,
                  onComplete() {
                    favicon.querySelector('img').remove();
                  } });
    
                to(elem, {
                  '--icon-offset': '0px',
                  '--icon-offset-line': '0px',
                  duration: .15,
                  delay: .2 });
    
              }
              to(elem, {
                '--clear-arrow-offset': '4px',
                '--clear-arrow-offset-second': '4px',
                '--clear-line-array': '8.5px',
                '--clear-line-offset': '27px',
                '--clear-long-offset': '24px',
                '--clear-rotate': '0deg',
                '--clear-arrow-o': 1,
                duration: 0,
                delay: .7,
                onStart() {
                  classList.remove('clearing');
                } });
    
              to(elem, {
                '--clear-opacity': 0,
                duration: .2,
                delay: .55 });
    
              to(elem, {
                '--clear-arrow-o': 0,
                '--clear-arrow-x': '0px',
                '--clear-arrow-y': '0px',
                '--clear-swipe': '0px',
                duration: .15 });
    
              to(svgLineProxy, {
                x: 0,
                duration: .45,
                ease: 'elastic.out(1, .75)' });
    
            } },
          {
            '--clear-swipe-x': 0,
            '--clear-x': '0px',
            duration: .4,
            delay: .35 }] });
    
    
        to(elem, {
          '--clear-arrow-offset': '0px',
          '--clear-arrow-offset-second': '8px',
          '--clear-line-array': '28.5px',
          '--clear-line-offset': '57px',
          '--clear-long-offset': '17px',
          duration: .2 });
    }
  </script>
</body>

</html>
